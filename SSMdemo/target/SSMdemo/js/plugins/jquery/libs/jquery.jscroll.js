(function(e){e.jscroll={defaults:{debug:!1,autoTrigger:!0,autoTriggerUntil:!1,loadingHtml:"<small>Loading...</small>",padding:0,nextSelector:"a:last",contentSelector:"",pagingSelector:"",callback:!1}};var t=function(t,n){function h(){var t=e(s.loadingHtml).filter("img").attr("src");if(t){var n=new Image;n.src=t}}function p(){t.find(".jscroll-inner").length||t.contents().wrapAll('<div class="jscroll-inner clearfix"/>')}function d(e){if(s.pagingSelector)var t=e.closest(s.pagingSelector).hide();else{var t=e.parent().not(".jscroll-inner,.jscroll-added").addClass("jscroll-next-parent").hide();t.length||e.wrap('<div class="jscroll-next-parent" />').parent().hide()}}function v(){return l.unbind(".jscroll").removeData("jscroll").find(".jscroll-inner").children().unwrap().filter(".jscroll-added").children().unwrap()}function m(){p();var e=t.find("div.jscroll-inner").first(),n=t.data("jscroll"),r=parseInt(t.css("borderTopWidth")),i=isNaN(r)?0:r,u=parseInt(t.css("paddingTop"))+i,a=o?l.scrollTop():t.offset().top,f=e.length?e.offset().top:0,c=Math.ceil(a-f+l.height()+u);if(!n.waiting&&c+s.padding+200>=e.outerHeight())return w("info","jScroll:",e.outerHeight()-c,"from bottom. Loading next request..."),b()}function g(e){return e=e||t.data("jscroll"),!e||!e.nextHref?(w("warn","jScroll: nextSelector not found - destroying"),v(),!1):(y(),!0)}function y(){var e=t.find(s.nextSelector).first();s.autoTrigger&&(s.autoTriggerUntil===!1||s.autoTriggerUntil>0)?(d(e),f.height()<=a.height()&&m(),l.unbind(".jscroll").bind("scroll.jscroll",function(){return m()}),s.autoTriggerUntil>0&&s.autoTriggerUntil--):(l.unbind(".jscroll"),e.bind("click.jscroll",function(){return d(e),b(),!1}))}function b(){var n=t.find("div.jscroll-inner").first(),r=t.data("jscroll");return r.waiting=!0,r.error||n.append('<div class="jscroll-added" />').children(".jscroll-added").last().html('<div class="jscroll-loading">'+s.loadingHtml+"</div>"),r.error=!1,t.animate({scrollTop:n.outerHeight()},0,function(){n.find("div.jscroll-added").last().load(r.nextHref,function(n,i,o){if(i==="error")return r.error=!0,r.waiting=!1,!1;var u=e(this).find(s.nextSelector).first();r.waiting=!1,r.nextHref=u.attr("href")?e.trim(u.attr("href")+" "+s.contentSelector):!1,e(".jscroll-next-parent",t).remove(),g(),s.callback&&s.callback.call(this),w("dir",r)})})}function w(e){if(s.debug&&typeof console=="object"&&(typeof e=="object"||typeof console[e]=="function"))if(typeof e=="object"){var t=[];for(var n in e)typeof console[n]=="function"?(t=e[n].length?e[n]:[e[n]],console[n].apply(console,t)):console.log.apply(console,t)}else console[e].apply(console,Array.prototype.slice.call(arguments,1))}var r=t.data("jscroll"),i=typeof n=="function"?{callback:n}:n,s=e.extend({},e.jscroll.defaults,i,r||{}),o=t.css("overflow-y")==="visible",u=t.find(s.nextSelector).first(),a=e(window),f=e("body"),l=o?a:t,c=e.trim(u.attr("href")+" "+s.contentSelector);return t.data("jscroll",e.extend({},r,{initialized:!0,waiting:!1,error:!1,nextHref:c})),p(),h(),y(),e.extend(t.jscroll,{destroy:v}),t};e.fn.jscroll=function(n){return this.each(function(){var r=e(this),i=r.data("jscroll");if(i&&i.initialized)return;var s=new t(r,n)})}})(jQuery)